#!/bin/bash
#
# http://www.dgbas.gov.tw/ct.asp?xItem=28536&ctNode=3292
# http://www.dgbas.gov.tw/ct.asp?xItem=28535&ctNode=3292
#

years="1981 1984 1986 1989 1991 1994 1996 1999 2001 2004 2006 2007 2008 2009 2010"

year_files()
{
    case "$1" in
        1981)
            echo "410271558471.ZIP 4102715582171.ZIP 4102715583571.ZIP "\
                 "4102715584871.ZIP 410271559171.ZIP 4102715591471.ZIP "\
                 "4102715592771.ZIP 4102715594271.ZIP 4102715595671.ZIP "\
                 "410271601371.ZIP 410271602971.ZIP 410271604071.ZIP"
            ;;
        1984)
            echo "41027164671.ZIP 410271641971.ZIP 410271643171.ZIP "\
                 "410271644271.ZIP 410271645871.ZIP 410271651071.ZIP "\
                 "410271652271.ZIP 410271653671.ZIP 410271654971.ZIP "\
                 "410271655971.ZIP 410271661071.ZIP 410271662271.ZIP"
            ;;
        1986)
            echo "410271685871.ZIP 410271691071.ZIP 410271692571.ZIP "\
                 "410271693871.ZIP 410271694871.ZIP 410271610171.ZIP "\
                 "4102716101271.ZIP 4102716102371.ZIP 4102716103771.ZIP "\
                 "4102716105271.ZIP 410271611271.ZIP 4102716111371.ZIP "\
                 "4102716112471.ZIP 4102716113771.ZIP 4102716114871.ZIP"
            ;;
        1989)
            echo "4102716234571.ZIP 4102716235971.ZIP 4102716241271.ZIP "\
                 "4102716242471.ZIP 4102716244371.ZIP 4102716245371.ZIP "\
                 "4102716254071.ZIP 4102716255571.ZIP 410271626771.ZIP "\
                 "4102716262071.ZIP 4102716263271.ZIP"
            ;;
        1991)
            echo "53115531371.zip 53115532671.zip 53115533871.zip "\
                 "53115534771.zip 53115535771.zip 5311554671.zip "\
                 "53115541571.zip 53115543571.zip 53115555371.zip "\
                 "5311556271.zip 53115561571.zip 5311557771.zip "\
                 "53115571771.zip 53115572771.zip "\
                 "53115334671.xls 53115455871.xls 53115461171.xls "\
                 "53115461971.xls 53115462971.xls 53115465371.xls "\
                 "53115471471.xls 53115472771.xls 53115475171.xls "\
                 "5311548571.xls  53115481871.xls 53115484071.xls "\
                 "53115514671.zip 53115515371.zip"
            ;;
        1994)
            echo "4102810555471.ZIP 410281056971.ZIP 4102810562271.ZIP "\
                 "4102810563671.ZIP 4102810565271.ZIP 410281057671.ZIP "\
                 "4102810572171.ZIP 4102810573771.ZIP 4102810575771.ZIP "\
                 "6122614502471.zip 6122614504871.zip "\
                 "4102810505571.xls 410281051971.xls 4102810512471.xls "\
                 "4102810514271.xls 4102810515371.xls 410281052571.xls "\
                 "4102810522171.xls 4102810524771.xls 4102810525971.xls "\
                 "410281053971.xls  4102810532171.xls"
            ;;
        1996)
            echo "4102811393071.ZIP 4102811394771.ZIP 4102811401471.ZIP "\
                 "4102811403671.ZIP 4102811405171.ZIP 410281141671.ZIP "\
                 "4102811412671.ZIP 4102811413971.ZIP 4102811415471.ZIP "\
                 "4102811421771.ZIP 4102811423271.ZIP 4102811424471.ZIP "\
                 "410281143371.ZIP 412221122871.ZIP "\
                 "410281134571.xls 4102811341571.xls 4102811342671.xls "\
                 "4102811343871.xls 4102811345171.xls 410281135171.xls "\
                 "4102811351271.xls 4102811352271.xls 4102811353471.xls "\
                 "4102811354671.xls 410281136471.xls 4102811361671.xls "\
                 "4102811464671.zip 410281147371.zip 4102811471971.zip "\
                 "4102811473471.zip 4102811475871.zip 4102811481871.zip"
            ;;
        1999)
            echo "410271547771.ZIP 4102715472271.ZIP 4102715473871.ZIP "\
                 "4102715475671.ZIP 410271548971.ZIP 4102715482971.ZIP "\
                 "4102715492971.ZIP 4102715494671.ZIP 61181633371.zip "\
                 "61181634871.zip 4102715511371.ZIP "\
                 "4102715414971.xls 41027154202.xls 4102715421071.xls "\
                 "4102715422171.xls 4102715423371.xls 4102715424571.xls "\
                 "4102715425671.xls 410271543971.xls 4102715432371.xls "\
                 "4102715434071.xls 4102715435171.xls"
            ;;
        2001)
            echo "4122111363671.xls 4122111372771.xls 4122111374271.xls "\
                 "4122111375671.xls 4122111381371.xls 4122111382971.xls "\
                 "4122111384271.xls 4122111385671.xls 4122111391271.xls "\
                 "4122111392671.xls 4122111393971.xls 4122111395071.xls "\
                 "4122111582371.ZIP 4122111584671.ZIP 412211159971.ZIP "\
                 "4122111593371.ZIP 4122111594471.ZIP 4122111595671.zip "\
                 "412211201171.zip 412211202771.zip 412211204171.zip "\
                 "412211205471.zip 41221121671.zip 412211211971.zip "\
                 "412211213171.zip 412211214371.zip "\
                 "412211263171.zip 412211264471.zip 412211265971.zip "\
                 "412211271871.zip"
            ;;
        2004)
            echo "611239581071.xls 6112314802.xls 6112314113971.xls "\
                 "6112314122471.xls 6112314134471.xls 6112314135371.xls "\
                 "611231414871.xls 6112314141871.xls 6112314143071.xls "\
                 "6112314171471.xls 6112314191271.xls "\
                 "6112410465071.zip 6112410452871.zip 611241047471.zip "\
                 "6112410464171.zip 6112410472971.zip 6112410454171.zip "\
                 "6112410455271.zip 611241046471.zip 6112410471771.zip "\
                 "6112410461971.zip 6112410462871.zip"
            ;;
        2006)
            echo "9121414285971.xls 9121414292271.xls 9121414292871.xls "\
                 "0129958171.xls 9121414294371.xls 9121414295071.xls "\
                 "9121414301171.xls 9121414301771.xls 9121414302471.xls "\
                 "9121414303271.xls 9121414303871.xls 9121414304471.xls "\
                 "912141433171.zip 912141433871.zip 9121414331471.zip "\
                 "9121414332271.zip 9121414333071.zip 9121414333771.zip "\
                 "9121414334471.zip 912141434971.zip 9121414335971.zip "\
                 "9121414341771.zip 9121414342371.zip 9121414343471.zip "\
                 "9121414344171.zip 9121414344871.zip "\
                 "9121414352371.zip 9121414353071.zip 9121414353771.zip "\
                 "9121414354471.zip "\
                 "1139202871.xls"
            ;;
        2007)
            echo "1139203871.xls"
            ;;
        2008)
            echo "1139204871.xls"
            ;;
        2009)
            # 1229101502 appears to be an updated version
            echo "11229101502.xls 1139205771.xls"
            ;;
        2010)
            echo "1122910141371.xls"
            ;;
    esac
}


SCRIPTDIR=`dirname $0`
. "$SCRIPTDIR/include.sh"

cd "${CACHE_DIR}"

stat_dir="${CACHE_DIR}/tw"
[ -d "$stat_dir" ] || mkdir -p "$stat_dir"

base_url="http://www.dgbas.gov.tw/public/Attachment"

for year in $years; do
    year_dir="$stat_dir/$year"
    [ -d "$year_dir" ] || mkdir -p "$year_dir"
    cd "$year_dir"
    
    files=`year_files $year`
    for aFile in $files; do
        [ -f "$aFile" ] || wget "$base_url/$aFile"

        testZip=${aFile/ZIP/zip}
        if [[ "$testZip" = *.zip ]]; then
            contents=`zipinfo -1 "$aFile"`
            [ -f "$contents" ] || unzip "$aFile"
        fi
    done
done

cd "${SCRIPTDIR}"
